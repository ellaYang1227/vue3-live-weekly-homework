import{bs as U,b8 as $,b9 as E,aw as m,ak as h,m as g,n as e,aK as u,u as l,b2 as F,a4 as y,b4 as O,l as P,t as b,F as x,b7 as R,au as q,k as B}from"./plugin-vueexport-helper-6502c603.js";import{a as D}from"./axios-bff3f665.js";import{L as N}from"./LoadingStore-344bc819.js";import{d as v}from"./Sweetalert2-options-02b29ef3.js";import{P as j}from"./PaginationComponent-a006d26b.js";import{F as H,a as z,E as K}from"./vee-validate.esm-753632ac.js";import{M as A}from"./bootstrap.esm-06211441.js";import{v as Y}from"./runtime-dom.esm-bundler-8d942a76.js";const{VITE_API_URL:L,VITE_API_PATH:V}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0},{showLoading:G,hideLoading:T}=N(),M=U("CouponStore",{state:()=>({coupons:{}}),actions:{getCoupons(o=1){G(),D.get(`${L}/api/${V}/admin/coupons?page=${o}`).then(t=>{const{coupons:n,pagination:a}=t.data;this.coupons={data:n,pagination:a},T()}).catch(t=>{T(),v("popup","error",t.response.data.message)})},addCoupon(o){return D.post(`${L}/api/${V}/admin/coupon`,{data:o}).then(t=>(v("toast","success","優惠券新增成功！"),this.getCoupons(),t.data.success)).catch(t=>(console.dir(t),v("toast","error","優惠券新增失敗！"),t.response.data.success))},editCoupon(o,t,n){return D.put(`${L}/api/${V}/admin/coupon/${o}`,{data:t}).then(a=>(v("toast","success","優惠券更新成功！"),this.getCoupons(n),a.data.success)).catch(a=>(console.dir(a),v("toast","error","優惠券更新失敗！"),a.response.data.success))}}});let k=null;const J={data(){return{currentCoupon:{},isLoading:!1}},mounted(){k=new A(document.getElementById("couponModal"),{keyboard:!1}),this.setDefaultCurrentCoupon()},components:{Form:H,Field:z,ErrorMessage:K},watch:{coupon(){if(this.setDefaultCurrentCoupon(),this.coupon.id){this.currentCoupon=this.coupon,this.currentCoupon.due_date=this.handleDue_date(this.currentCoupon.due_date);const o=/\//gi;this.currentCoupon.due_date=this.currentCoupon.due_date.replace(o,"-")}}},methods:{...$(M,["addCoupon","editCoupon"]),setDefaultCurrentCoupon(){this.currentCoupon={title:"",is_enabled:1,percent:10,code:"",due_date:""}},openModal(){k.show()},addOrEditProduct(){const o={...this.currentCoupon};o.due_date=new Date(o.due_date).getTime()/1e3,this.isLoading=!0,o.id?this.editCoupon(o.id,o,this.page).then(t=>{this.isLoading=!1,t&&k.hide()}):this.addCoupon(o).then(t=>{this.isLoading=!1,t&&k.hide()})},isDueDate(o){return new Date(o)>=new Date?!0:"必填欄位。不能小於今天"}},props:{coupon:{type:Object,required:!1},handleDue_date:{type:Function,required:!0},page:{type:Number,required:!0}}},Q=["data-bs-backdrop"],W={class:"modal-dialog"},X={class:"modal-content"},Z={class:"modal-header bg-light"},ee={class:"modal-title"},oe=["disabled"],te=["disabled"],se={class:"modal-body"},ne={class:"mb-3"},ae=e("label",{for:"titleInput",class:"form-label"},[b("名稱"),e("span",{class:"text-danger"},"*")],-1),le={class:"mb-3"},de=e("label",{for:"codeInput",class:"form-label"},[b("優惠碼"),e("span",{class:"text-danger"},"*")],-1),ie={class:"mb-3"},re=e("label",{for:"due_dateInput",class:"form-label"},[b("到期日"),e("span",{class:"text-danger"},"*")],-1),ce={class:"mb-3"},ue=e("label",{for:"codeInput",class:"form-label"},[b("折扣(%)"),e("span",{class:"text-danger"},"*")],-1),pe={class:"mb-3"},_e={class:"form-check"},me=e("label",{class:"form-check-label ms-1",for:"is_enabledCheckbox"}," 是否啟用",-1),he={class:"modal-footer"},be=["disabled"],ge=["disabled"],Ce={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function fe(o,t,n,a,s,d){var w;const p=m("Field"),c=m("ErrorMessage"),C=m("Form");return h(),g("div",{class:"modal fade",tabindex:"-1",id:"couponModal","aria-labelledby":"couponModalLabel","data-bs-backdrop":s.isLoading?!0:"static","aria-hidden":"true"},[e("div",W,[e("div",X,[e("div",Z,[e("h5",ee,u((w=s.currentCoupon)!=null&&w.id?"修改":"新增")+"優惠券",1),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:s.isLoading},null,8,oe)]),l(C,{onSubmit:d.addOrEditProduct},{default:F(({errors:_})=>{var f;return[e("fieldset",{disabled:s.isLoading},[e("div",se,[e("div",ne,[ae,l(p,{id:"titleInput",name:"名稱",type:"text",class:y(["form-control",{"is-invalid":_.名稱}]),placeholder:"請輸入名稱",rules:"required",modelValue:s.currentCoupon.title,"onUpdate:modelValue":t[0]||(t[0]=i=>s.currentCoupon.title=i)},null,8,["class","modelValue"]),l(c,{name:"名稱",class:"invalid-feedback"})]),e("div",le,[de,l(p,{id:"codeInput",name:"優惠碼",type:"text",class:y(["form-control",{"is-invalid":_.優惠碼}]),placeholder:"請輸入優惠碼",rules:"required",modelValue:s.currentCoupon.code,"onUpdate:modelValue":t[1]||(t[1]=i=>s.currentCoupon.code=i)},null,8,["class","modelValue"]),l(c,{name:"優惠碼",class:"invalid-feedback"})]),e("div",ie,[re,l(p,{id:"due_dateInput",name:"到期日",type:"date",class:y(["form-control",{"is-invalid":_.到期日}]),placeholder:"請輸入到期日",rules:d.isDueDate,modelValue:s.currentCoupon.due_date,"onUpdate:modelValue":t[2]||(t[2]=i=>s.currentCoupon.due_date=i)},null,8,["class","rules","modelValue"]),l(c,{name:"到期日",class:"invalid-feedback"})]),e("div",ce,[ue,l(p,{id:"codeInput",name:"折扣",type:"number",class:y(["form-control",{"is-invalid":_.折扣}]),placeholder:"請輸入折扣(%)",rules:"required|min_value:0|max_value:100|integer",modelValue:s.currentCoupon.percent,"onUpdate:modelValue":t[3]||(t[3]=i=>s.currentCoupon.percent=i),modelModifiers:{number:!0}},null,8,["class","modelValue"]),l(c,{name:"折扣",class:"invalid-feedback"})]),e("div",pe,[e("div",_e,[O(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=i=>s.currentCoupon.is_enabled=i),id:"is_enabledCheckbox"},null,512),[[Y,s.currentCoupon.is_enabled]]),me])])]),e("div",he,[e("button",{type:"button",class:"btn btn-secondary ms-auto","data-bs-dismiss":"modal",disabled:s.isLoading},"取消",8,be),e("button",{type:"submit",class:"btn btn-primary",disabled:s.isLoading||Object.keys(_).length},[s.isLoading?(h(),g("span",Ce)):P("",!0),b(" "+u((f=s.currentCoupon)!=null&&f.id?"修改":"新增"),1)],8,ge)])],8,te)]}),_:1},8,["onSubmit"])])])],8,Q)}const ve=E(J,[["render",fe]]),{VITE_API_URL:ye,VITE_API_PATH:we}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0};let I=null;const ke={data(){return{isLoading:!1}},mounted(){I=new A(document.getElementById("delCouponModal"),{keyboard:!1})},methods:{...$(M,["getCoupons"]),openModal(){I.show()},closeModal(o,t){this.isLoading=!1,I.hide(),o==="success"&&this.getCoupons(this.page),setTimeout(()=>{const n=`刪除${o==="success"?"成功":"失敗"}`;this.$refs.sweetalert.showSwal("popup","error",n,t)},500)},delCoupon(){this.isLoading=!0,this.$http.delete(`${ye}/api/${we}/admin/coupon/${this.coupon.id}`).then(o=>{this.closeModal("success",o.data.message)}).catch(o=>{this.closeModal("error",o.response.data.message)})}},props:{coupon:{type:Object,required:!0},page:{type:Number,required:!0}}},Me=["data-bs-backdrop"],De={class:"modal-dialog"},Le={class:"modal-content"},Ve={class:"modal-header bg-danger text-white"},Ie=e("h5",{class:"modal-title"},"刪除優惠券",-1),xe=["disabled"],$e={class:"modal-body"},Ee={class:"modal-footer"},Pe=["disabled"],Te=["disabled"],Ae={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Se(o,t,n,a,s,d){var c;const p=m("sweetalert-component");return h(),g(x,null,[l(p,{ref:"sweetalert"},null,512),e("div",{class:"modal fade",tabindex:"-1",id:"delCouponModal","aria-labelledby":"delCouponModalLabel","data-bs-backdrop":s.isLoading?!0:"static","aria-hidden":"true"},[e("div",De,[e("div",Le,[e("div",Ve,[Ie,e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",disabled:s.isLoading},null,8,xe)]),e("div",$e,[e("p",null,[b(" 請確認是否"),e("strong",null,"刪除「"+u((c=n.coupon)==null?void 0:c.title)+"」優惠券",1),b("，刪除後您再也無法復原？ ")])]),e("div",Ee,[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",disabled:s.isLoading},"否",8,Pe),e("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...C)=>d.delCoupon&&d.delCoupon(...C)),disabled:s.isLoading},[s.isLoading?(h(),g("span",Ae)):P("",!0),b(" 是，確認刪除 ")],8,Te)])])])],8,Me)],64)}const Ue=E(ke,[["render",Se]]);const Fe={data(){return{currentCoupon:{}}},computed:{...R(M,["coupons"]),couponTotal(){return this.coupons.data?Object.keys(this.coupons.data).length:0}},mounted(){this.getCoupons()},components:{PaginationComponent:j,CouponModal:ve,DelCouponModal:Ue},methods:{...$(M,["getCoupons"]),handleDue_date(o){o=new Date(o*1e3);const t=o.getFullYear();let n=o.getMonth()+1;n=this.transformTwoDigits(n);let a=o.getDate();return a=this.transformTwoDigits(a),`${t}/${n}/${a}`},transformTwoDigits(o){return 10>o&&(o=`0${o}`),o},openModal(o,t){this.currentCoupon={...t},o==="del"?this.$refs.childDelCouponModal.openModal():this.$refs.childCouponModal.openModal()}}},Oe={class:"container"},Re={class:"d-flex justify-content-between align-items-center mb-3"},qe=e("h1",{class:"mb-0 h4 fw-bold"},"優惠券",-1),Be={class:"table table-striped table-hover text-center align-middle"},Ne=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"名稱"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣(%)"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col",width:"150px"},"功能")])],-1),je={class:"text-start"},He={class:"h6 mb-0 text-truncate fw-bold"},ze=["onClick"],Ke=["onClick"],Ye={scope:"col",colspan:"6",class:"text-start"};function Ge(o,t,n,a,s,d){var _,f,i;const p=m("SweetalertComponent"),c=m("PaginationComponent"),C=m("DelCouponModal"),w=m("CouponModal");return h(),g(x,null,[l(p,{ref:"sweetalert"},null,512),e("div",Oe,[e("div",Re,[qe,e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=r=>d.openModal("add"))},"新增優惠券")]),e("table",Be,[Ne,e("tbody",null,[(h(!0),g(x,null,q(o.coupons.data,r=>(h(),g("tr",{key:r.id},[e("th",je,[e("h4",He,u(r.title),1)]),e("td",null,u(r.code),1),e("td",null,u(r.percent)+"%",1),e("td",null,u(d.handleDue_date(r.due_date)),1),e("td",null,[e("strong",{class:y([r.is_enabled?"text-success":"text-danger"])},u(r.is_enabled?"啟用":"停用"),3)]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:S=>d.openModal("edit",r)},"編輯",8,ze),e("button",{type:"button",class:"btn btn-outline-danger btn-sm ms-1",onClick:S=>d.openModal("del",r)},"刪除",8,Ke)])]))),128))]),e("tfoot",null,[e("tr",null,[e("th",Ye,"優惠券數量："+u(d.couponTotal)+" 筆",1)])])]),(_=o.coupons.pagination)!=null&&_.total_pages?(h(),B(c,{key:0,pagination:o.coupons.pagination,onSwitchPage:o.getCoupons},null,8,["pagination","onSwitchPage"])):P("",!0),l(C,{ref:"childDelCouponModal",coupon:s.currentCoupon,page:(f=o.coupons.pagination)==null?void 0:f.current_page},null,8,["coupon","page"]),l(w,{ref:"childCouponModal",coupon:s.currentCoupon,handleDue_date:d.handleDue_date,page:(i=o.coupons.pagination)==null?void 0:i.current_page},null,8,["coupon","handleDue_date","page"])])],64)}const so=E(Fe,[["render",Ge]]);export{so as default};
