import{bs as H,b7 as U,b8 as k,b9 as $,aw as p,ak as a,m as l,u as O,n as e,b4 as z,aK as r,a4 as F,F as b,t as n,l as f,au as S,k as M}from"./plugin-vueexport-helper-6502c603.js";import{a as V}from"./axios-bff3f665.js";import{L as K}from"./LoadingStore-344bc819.js";import{d as v}from"./Sweetalert2-options-02b29ef3.js";import{P as Y}from"./PaginationComponent-a006d26b.js";import{M as N}from"./bootstrap.esm-06211441.js";import{v as G}from"./runtime-dom.esm-bundler-8d942a76.js";const{VITE_API_URL:q,VITE_API_PATH:B}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0},{showLoading:J,hideLoading:R}=K(),w=H("OrderStore",{state:()=>({orders:{}}),actions:{getOrders(t=1){J(),V.get(`${q}/api/${B}/admin/orders?page=${t}`).then(d=>{const{orders:s,pagination:c}=d.data;this.orders={data:s,pagination:c},R()}).catch(d=>{R(),v("popup","error",d.response.data.message)})},editOrder(t,d,s){const c={is_paid:d};return V.put(`${q}/api/${B}/admin/order/${t}`,{data:c}).then(o=>(v("toast","success","訂單更新成功！"),this.getOrders(s),o.data.success)).catch(o=>(console.dir(o),v("toast","error","訂單更新失敗！"),o.response.data.success))}}}),Q={data(){return{switchIsPaid:!0}},props:{order:{type:Object,required:!0,deep:!0},updateMethod:{type:String,required:!1,default:"immediate"},isLgSize:{type:Boolean,required:!1,default:!1},page:{type:Number,required:!1}},emits:["set-is-paid"],mounted(){this.switchIsPaid=this.order.is_paid},computed:{...U(w,["is_paid"])},watch:{order(){this.switchIsPaid=this.order.is_paid}},methods:{...k(w,["editOrder"]),changeIsPaid(){this.updateMethod==="parent"?this.$emit("setIsPaid",this.switchIsPaid):this.updateMethod==="immediate"&&this.editOrder(this.order.id,this.switchIsPaid,this.page)},getTimestamp(){return new Date().getTime()}}},W=["id"],X=["for"];function Z(t,d,s,c,o,i){const u=p("sweetalert-component");return a(),l(b,null,[O(u,{ref:"sweetalert"},null,512),e("div",{class:F(["form-check form-switch",{"form-control-lg m-0":s.isLgSize}])},[z(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`${s.order.id}-${i.getTimestamp()}`,"onUpdate:modelValue":d[0]||(d[0]=h=>o.switchIsPaid=h),onChange:d[1]||(d[1]=(...h)=>i.changeIsPaid&&i.changeIsPaid(...h))},null,40,W),[[G,o.switchIsPaid,void 0,{lazy:!0}]]),e("label",{class:"form-check-label fw-bold",for:`${s.order.id}-${i.getTimestamp()}`},r(o.switchIsPaid?"已付款":"未付款"),9,X)],2)],64)}const j=$(Q,[["render",Z]]);let L=null;const ee={data(){return{isLoading:!1,is_paid:null}},mounted(){L=new N(document.getElementById("orderModal"),{keyboard:!1})},components:{SwitchIsPaid:j},watch:{order(){this.is_paid=this.order.is_paid}},methods:{...k(w,["editOrder"]),openModal(){L.show()},editOrderAPI(){this.isLoading=!0,this.editOrder(this.order.id,this.is_paid,this.page).then(t=>{this.isLoading=!1,t&&setTimeout(()=>{L.hide()},1e3)})},setIsPaid(t){this.is_paid=t}},props:{order:{type:Object,required:!1},handleCreate_at:{type:Function,required:!0},page:{type:Number,required:!0}}},te=["data-bs-backdrop"],se={class:"modal-dialog modal-lg"},oe={class:"modal-content"},de={class:"modal-header bg-light"},re=e("h5",{class:"modal-title"},"訂單細節",-1),ie=["disabled"],ae={class:"modal-body"},ne={class:"list-group list-group-flush"},le={class:"list-group-item"},ce={class:"list-unstyled mb-0"},ue=e("strong",null,"訂單編號：",-1),he=e("strong",null,"訂單時間：",-1),_e={class:"mt-3"},me=e("strong",null,"訂購人：",-1),pe=e("strong",null,"E-Mail： ",-1),ge=e("strong",null,"聯絡電話：",-1),be=e("strong",null,"出貨地址：",-1),fe={key:0},we=e("strong",null,"留言：",-1),ye={class:"mb-0"},Oe={class:"list-group-item p-0"},Pe={class:"list-group list-group-flush list-group-numbered"},Ie={class:"ms-2 me-auto"},ke={class:"fw-bold"},$e={class:"text-muted"},Me={style:{width:"30%"},class:"text-end"},ve={class:"text-danger ms-2"},Le={class:"list-group-item text-end"},Te={class:"text-danger ms-2"},Se={class:"modal-footer"},xe=["disabled"],Ae=["disabled"],Ce={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function De(t,d,s,c,o,i){var h,g,P,I;const u=p("SwitchIsPaid");return a(),l("div",{class:"modal fade",tabindex:"-1",id:"orderModal","aria-labelledby":"orderModalLabel","data-bs-backdrop":o.isLoading?!0:"static","aria-hidden":"true"},[e("div",se,[e("div",oe,[e("div",de,[re,e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:o.isLoading},null,8,ie)]),e("div",ae,[e("ul",ne,[e("li",le,[e("ul",ce,[e("li",null,[ue,n(r(s.order.id),1)]),e("li",null,[he,n(r(s.handleCreate_at(s.order.create_at)),1)]),e("li",_e,[me,n(r((h=s.order.user)==null?void 0:h.name),1)]),e("li",null,[pe,n(r((g=s.order.user)==null?void 0:g.email),1)]),e("li",null,[ge,n(r((P=s.order.user)==null?void 0:P.tel),1)]),e("li",null,[be,n(r((I=s.order.user)==null?void 0:I.address),1)]),s.order.message?(a(),l("li",fe,[we,e("p",ye,r(s.order.message),1)])):f("",!0)])]),e("li",Oe,[e("ol",Pe,[(a(!0),l(b,null,S(s.order.products,_=>(a(),l("li",{class:"list-group-item d-flex justify-content-between align-items-start",key:_.product.id},[e("div",Ie,[e("div",ke,r(_.product.title),1),e("span",$e,r(_.product.category),1)]),e("div",Me,[n(r(`${_.qty} ${_.product.unit}`)+" ",1),e("strong",ve,"$"+r(_.product.price),1)])]))),128))])]),e("li",Le,[n(" 總計 "),e("strong",Te,"$"+r(s.order.total),1)])])]),e("div",Se,[O(u,{order:s.order,isLgSize:!0,updateMethod:"parent",onSetIsPaid:i.setIsPaid},null,8,["order","onSetIsPaid"]),e("button",{type:"button",class:"btn btn-secondary ms-auto","data-bs-dismiss":"modal",disabled:o.isLoading},"取消",8,xe),e("button",{type:"submit",class:"btn btn-primary",disabled:o.isLoading||o.is_paid===s.order.is_paid,onClick:d[0]||(d[0]=(..._)=>i.editOrderAPI&&i.editOrderAPI(..._))},[o.isLoading?(a(),l("span",Ce)):f("",!0),n(" 修改 ")],8,Ae)])])])],8,te)}const Ee=$(ee,[["render",De]]),{VITE_API_URL:Ve,VITE_API_PATH:qe}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0};let T=null;const Be={data(){return{isLoading:!1}},mounted(){T=new N(document.getElementById("delOrderModal"),{keyboard:!1})},methods:{...k(w,["getOrders"]),openModal(){T.show()},closeModal(t,d){this.isLoading=!1,T.hide(),t==="success"&&this.getOrders(this.page),setTimeout(()=>{const s=`刪除${t==="success"?"成功":"失敗"}`;this.$refs.sweetalert.showSwal("popup","error",s,d)},500)},delOrder(){this.isLoading=!0,this.$http.delete(`${Ve}/api/${qe}/admin/order/${this.order.id}`).then(t=>{this.closeModal("success",t.data.message)}).catch(t=>{this.closeModal("error",t.response.data.message)})}},props:{order:{type:Object,required:!0},page:{type:Number,required:!0}}},Re=["data-bs-backdrop"],Ue={class:"modal-dialog"},Ne={class:"modal-content"},je={class:"modal-header bg-danger text-white"},He=e("h5",{class:"modal-title"},"刪除訂單",-1),ze=["disabled"],Fe={class:"modal-body"},Ke={class:"modal-footer"},Ye=["disabled"],Ge=["disabled"],Je={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Qe(t,d,s,c,o,i){var h;const u=p("sweetalert-component");return a(),l(b,null,[O(u,{ref:"sweetalert"},null,512),e("div",{class:"modal fade",tabindex:"-1",id:"delOrderModal","aria-labelledby":"delOrderModalLabel","data-bs-backdrop":o.isLoading?!0:"static","aria-hidden":"true"},[e("div",Ue,[e("div",Ne,[e("div",je,[He,e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",disabled:o.isLoading},null,8,ze)]),e("div",Fe,[e("p",null,[n(" 請確認是否"),e("strong",null,"刪除「"+r((h=s.order)==null?void 0:h.id)+"」訂單",1),n("，刪除後您再也無法復原？ ")])]),e("div",Ke,[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",disabled:o.isLoading},"否",8,Ye),e("button",{type:"button",class:"btn btn-danger",onClick:d[0]||(d[0]=(...g)=>i.delOrder&&i.delOrder(...g)),disabled:o.isLoading},[o.isLoading?(a(),l("span",Je)):f("",!0),n(" 是，確認刪除 ")],8,Ge)])])])],8,Re)],64)}const We=$(Be,[["render",Qe]]);const Xe={data(){return{currentOrder:{}}},computed:{...U(w,["orders"]),orderTotal(){return this.orders.data?Object.keys(this.orders.data).length:0}},mounted(){this.getOrders()},components:{PaginationComponent:Y,OrderModal:Ee,DelOrderModal:We,SwitchIsPaid:j},methods:{...k(w,["getOrders"]),handleCreate_at(t){t=new Date(t*1e3);const d=t.getFullYear();let s=t.getMonth()+1;s=this.transformTwoDigits(s);let c=t.getDate();c=this.transformTwoDigits(c);let o=t.getHours();o=this.transformTwoDigits(o);let i=t.getMinutes();i=this.transformTwoDigits(i);let u=t.getSeconds();return u=this.transformTwoDigits(u),`${d}/${s}/${c} ${o}:${i}:${u}`},transformTwoDigits(t){return 10>t&&(t=`0${t}`),t},openModal(t,d){this.currentOrder={...d},t==="del"?this.$refs.childDelOrderModal.openModal():this.$refs.childOrderModal.openModal()}}},Ze={class:"container"},et=e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[e("h1",{class:"mb-0 h4 fw-bold"},"訂單管理")],-1),tt={class:"table table-striped table-hover text-center align-middle"},st=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"訂單編號"),e("th",{scope:"col"},"購買人"),e("th",{scope:"col"},"購買產品"),e("th",{scope:"col"},"訂單金額"),e("th",{scope:"col"},"是否付款"),e("th",{scope:"col",width:"150px"},"功能")])],-1),ot={class:"text-start"},dt={class:"h6 mb-0 text-truncate fw-bold"},rt={class:"d-block text-muted"},it={class:"text-start"},at={class:"d-block text-muted"},nt={class:"d-block text-muted"},lt={class:"text-start"},ct={class:"list-unstyled mb-0"},ut={class:"text-end"},ht=["onClick"],_t=["onClick"],mt={scope:"col",colspan:"6",class:"text-start"};function pt(t,d,s,c,o,i){var _,x,A,C,D,E;const u=p("SweetalertComponent"),h=p("SwitchIsPaid"),g=p("PaginationComponent"),P=p("DelOrderModal"),I=p("OrderModal");return a(),l(b,null,[O(u,{ref:"sweetalert"},null,512),e("div",Ze,[et,e("table",tt,[st,e("tbody",null,[(a(!0),l(b,null,S(t.orders.data,m=>(a(),l("tr",{key:m.id},[e("th",ot,[e("h4",dt,r(m.id),1),e("small",rt,r(i.handleCreate_at(m.create_at)),1)]),e("td",it,[n(r(m.user.name)+" ",1),e("small",at,r(m.user.email),1),e("small",nt,r(m.user.tel),1)]),e("td",lt,[e("ul",ct,[(a(!0),l(b,null,S(m.products,y=>(a(),l("li",{key:y.id},r(`${y.product.title} *${y.qty}`),1))),128))])]),e("td",ut,"$"+r(m.total),1),e("td",null,[O(h,{order:m,page:t.orders.pagination.current_page},null,8,["order","page"])]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:y=>i.openModal("check",m)},"查看",8,ht),e("button",{type:"button",class:"btn btn-outline-danger btn-sm ms-1",onClick:y=>i.openModal("del",m)},"刪除",8,_t)])]))),128))]),e("tfoot",null,[e("tr",null,[e("th",mt,"訂單數量："+r(i.orderTotal)+" 筆",1)])])]),(_=t.orders.pagination)!=null&&_.total_pages?(a(),M(g,{key:0,pagination:t.orders.pagination,onSwitchPage:t.getOrders},null,8,["pagination","onSwitchPage"])):f("",!0),n(r((x=t.orders.pagination)==null?void 0:x.current_page)+" ",1),(A=t.orders.pagination)!=null&&A.current_page?(a(),M(P,{key:1,ref:"childDelOrderModal",order:o.currentOrder,page:(C=t.orders.pagination)==null?void 0:C.current_page},null,8,["order","page"])):f("",!0),(D=t.orders.pagination)!=null&&D.current_page?(a(),M(I,{key:2,ref:"childOrderModal",order:o.currentOrder,"handle-create_at":i.handleCreate_at,page:(E=t.orders.pagination)==null?void 0:E.current_page},null,8,["order","handle-create_at","page"])):f("",!0)])],64)}const It=$(Xe,[["render",pt]]);export{It as default};
