import{bs as R,b7 as V,b8 as $,b9 as k,aw as p,ak as a,m as l,u as g,n as e,b4 as U,aK as r,a4 as N,F as f,t as n,l as I,au as T,k as j}from"./plugin-vueexport-helper-6502c603.js";import{a as A}from"./axios-bff3f665.js";import{L as H}from"./LoadingStore-344bc819.js";import{d as M}from"./Sweetalert2-options-02b29ef3.js";import{P as z}from"./PaginationComponent-a006d26b.js";import{M as q}from"./bootstrap.esm-06211441.js";import{v as F}from"./runtime-dom.esm-bundler-8d942a76.js";const{VITE_API_URL:C,VITE_API_PATH:D}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0},{showLoading:K,hideLoading:E}=H(),w=R("OrderStore",{state:()=>({orders:{}}),actions:{getOrders(t=1){K(),A.get(`${C}/api/${D}/admin/orders?page=${t}`).then(d=>{const{orders:s,pagination:c}=d.data;this.orders={data:s,pagination:c},E()}).catch(d=>{E(),M("popup","error",d.response.data.message)})},editOrder(t,d,s){const c={is_paid:d};return A.put(`${C}/api/${D}/admin/order/${t}`,{data:c}).then(o=>(M("toast","success","訂單更新成功！"),this.getOrders(s),o.data.success)).catch(o=>(console.dir(o),M("toast","error","訂單更新失敗！"),o.response.data.success))}}}),Y={data(){return{switchIsPaid:!0}},props:{order:{type:Object,required:!0,deep:!0},updateMethod:{type:String,required:!1,default:"immediate"},isLgSize:{type:Boolean,required:!1,default:!1},page:{type:Number,required:!0}},mounted(){this.switchIsPaid=this.order.is_paid},computed:{...V(w,["is_paid"])},watch:{order(){this.switchIsPaid=this.order.is_paid}},methods:{...$(w,["editOrder"]),changeIsPaid(){this.updateMethod==="parent"?this.$emit("setIsPaid",this.switchIsPaid):this.updateMethod==="immediate"&&this.editOrder(this.order.id,this.switchIsPaid,this.page)},getTimestamp(){return new Date().getTime()}}},G=["id"],J=["for"];function Q(t,d,s,c,o,i){const u=p("sweetalert-component");return a(),l(f,null,[g(u,{ref:"sweetalert"},null,512),e("div",{class:N(["form-check form-switch",{"form-control-lg m-0":s.isLgSize}])},[U(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`${s.order.id}-${i.getTimestamp()}`,"onUpdate:modelValue":d[0]||(d[0]=h=>o.switchIsPaid=h),onChange:d[1]||(d[1]=(...h)=>i.changeIsPaid&&i.changeIsPaid(...h))},null,40,G),[[F,o.switchIsPaid,void 0,{lazy:!0}]]),e("label",{class:"form-check-label fw-bold",for:`${s.order.id}-${i.getTimestamp()}`},r(o.switchIsPaid?"已付款":"未付款"),9,J)],2)],64)}const B=k(Y,[["render",Q]]);let v=null;const W={data(){return{isLoading:!1,is_paid:null}},mounted(){v=new q(document.getElementById("orderModal"),{keyboard:!1})},components:{SwitchIsPaid:B},watch:{order(){this.is_paid=this.order.is_paid}},methods:{...$(w,["editOrder"]),openModal(){v.show()},editOrderAPI(){this.isLoading=!0,this.editOrder(this.order.id,this.is_paid,this.page).then(t=>{this.isLoading=!1,t&&setTimeout(()=>{v.hide()},1e3)})},setIsPaid(t){this.is_paid=t}},props:{order:{type:Object,required:!1},handleCreate_at:{type:Function,required:!0},page:{type:Number,required:!0}}},X=["data-bs-backdrop"],Z={class:"modal-dialog modal-lg"},ee={class:"modal-content"},te={class:"modal-header bg-light"},se=e("h5",{class:"modal-title"},"訂單細節",-1),oe=["disabled"],de={class:"modal-body"},re={class:"list-group list-group-flush"},ie={class:"list-group-item"},ae={class:"list-unstyled mb-0"},ne=e("strong",null,"訂單編號：",-1),le=e("strong",null,"訂單時間：",-1),ce={class:"mt-3"},ue=e("strong",null,"訂購人：",-1),he=e("strong",null,"E-Mail： ",-1),_e=e("strong",null,"聯絡電話：",-1),me=e("strong",null,"出貨地址：",-1),pe={key:0},ge=e("strong",null,"留言：",-1),be={class:"mb-0"},fe={class:"list-group-item p-0"},we={class:"list-group list-group-flush list-group-numbered"},ye={class:"ms-2 me-auto"},Oe={class:"fw-bold"},Pe={class:"text-muted"},Ie={style:{width:"30%"},class:"text-end"},$e={class:"text-danger ms-2"},ke={class:"list-group-item text-end"},Me={class:"text-danger ms-2"},ve={class:"modal-footer"},Le=["disabled"],Te=["disabled"],xe={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Se(t,d,s,c,o,i){var h,b,O,P;const u=p("SwitchIsPaid");return a(),l("div",{class:"modal fade",tabindex:"-1",id:"orderModal","aria-labelledby":"orderModalLabel","data-bs-backdrop":o.isLoading?!0:"static","aria-hidden":"true"},[e("div",Z,[e("div",ee,[e("div",te,[se,e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:o.isLoading},null,8,oe)]),e("div",de,[e("ul",re,[e("li",ie,[e("ul",ae,[e("li",null,[ne,n(r(s.order.id),1)]),e("li",null,[le,n(r(s.handleCreate_at(s.order.create_at)),1)]),e("li",ce,[ue,n(r((h=s.order.user)==null?void 0:h.name),1)]),e("li",null,[he,n(r((b=s.order.user)==null?void 0:b.email),1)]),e("li",null,[_e,n(r((O=s.order.user)==null?void 0:O.tel),1)]),e("li",null,[me,n(r((P=s.order.user)==null?void 0:P.address),1)]),s.order.message?(a(),l("li",pe,[ge,e("p",be,r(s.order.message),1)])):I("",!0)])]),e("li",fe,[e("ol",we,[(a(!0),l(f,null,T(s.order.products,_=>(a(),l("li",{class:"list-group-item d-flex justify-content-between align-items-start",key:_.product.id},[e("div",ye,[e("div",Oe,r(_.product.title),1),e("span",Pe,r(_.product.category),1)]),e("div",Ie,[n(r(`${_.qty} ${_.product.unit}`)+" ",1),e("strong",$e,"$"+r(_.product.price),1)])]))),128))])]),e("li",ke,[n(" 總計 "),e("strong",Me,"$"+r(s.order.total),1)])])]),e("div",ve,[g(u,{order:s.order,isLgSize:!0,updateMethod:"parent",onSetIsPaid:i.setIsPaid},null,8,["order","onSetIsPaid"]),e("button",{type:"button",class:"btn btn-secondary ms-auto","data-bs-dismiss":"modal",disabled:o.isLoading},"取消",8,Le),e("button",{type:"submit",class:"btn btn-primary",disabled:o.isLoading||o.is_paid===s.order.is_paid,onClick:d[0]||(d[0]=(..._)=>i.editOrderAPI&&i.editOrderAPI(..._))},[o.isLoading?(a(),l("span",xe)):I("",!0),n(" 修改 ")],8,Te)])])])],8,X)}const Ae=k(W,[["render",Se]]),{VITE_API_URL:Ce,VITE_API_PATH:De}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0};let L=null;const Ee={data(){return{isLoading:!1}},mounted(){L=new q(document.getElementById("delOrderModal"),{keyboard:!1})},methods:{...$(w,["getOrders"]),openModal(){L.show()},closeModal(t,d){this.isLoading=!1,L.hide(),t==="success"&&this.getOrders(this.page),setTimeout(()=>{const s=`刪除${t==="success"?"成功":"失敗"}`;this.$refs.sweetalert.showSwal("popup","error",s,d)},500)},delOrder(){this.isLoading=!0,this.$http.delete(`${Ce}/api/${De}/admin/order/${this.order.id}`).then(t=>{this.closeModal("success",t.data.message)}).catch(t=>{this.closeModal("error",t.response.data.message)})}},props:{order:{type:Object,required:!0},page:{type:Number,required:!0}}},Ve=["data-bs-backdrop"],qe={class:"modal-dialog"},Be={class:"modal-content"},Re={class:"modal-header bg-danger text-white"},Ue=e("h5",{class:"modal-title"},"刪除訂單",-1),Ne=["disabled"],je={class:"modal-body"},He={class:"modal-footer"},ze=["disabled"],Fe=["disabled"],Ke={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Ye(t,d,s,c,o,i){var h;const u=p("sweetalert-component");return a(),l(f,null,[g(u,{ref:"sweetalert"},null,512),e("div",{class:"modal fade",tabindex:"-1",id:"delOrderModal","aria-labelledby":"delOrderModalLabel","data-bs-backdrop":o.isLoading?!0:"static","aria-hidden":"true"},[e("div",qe,[e("div",Be,[e("div",Re,[Ue,e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",disabled:o.isLoading},null,8,Ne)]),e("div",je,[e("p",null,[n(" 請確認是否"),e("strong",null,"刪除「"+r((h=s.order)==null?void 0:h.id)+"」訂單",1),n("，刪除後您再也無法復原？ ")])]),e("div",He,[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",disabled:o.isLoading},"否",8,ze),e("button",{type:"button",class:"btn btn-danger",onClick:d[0]||(d[0]=(...b)=>i.delOrder&&i.delOrder(...b)),disabled:o.isLoading},[o.isLoading?(a(),l("span",Ke)):I("",!0),n(" 是，確認刪除 ")],8,Fe)])])])],8,Ve)],64)}const Ge=k(Ee,[["render",Ye]]);const Je={data(){return{currentOrder:{}}},computed:{...V(w,["orders"]),orderTotal(){return this.orders.data?Object.keys(this.orders.data).length:0}},mounted(){this.getOrders()},components:{PaginationComponent:z,OrderModal:Ae,DelOrderModal:Ge,SwitchIsPaid:B},methods:{...$(w,["getOrders"]),handleCreate_at(t){t=new Date(t*1e3);const d=t.getFullYear();let s=t.getMonth()+1;s=this.transformTwoDigits(s);let c=t.getDate();c=this.transformTwoDigits(c);let o=t.getHours();o=this.transformTwoDigits(o);let i=t.getMinutes();i=this.transformTwoDigits(i);let u=t.getSeconds();return u=this.transformTwoDigits(u),`${d}/${s}/${c} ${o}:${i}:${u}`},transformTwoDigits(t){return 10>t&&(t=`0${t}`),t},openModal(t,d){this.currentOrder={...d},t==="del"?this.$refs.childDelOrderModal.openModal():this.$refs.childOrderModal.openModal()}}},Qe={class:"container"},We=e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[e("h1",{class:"mb-0 h4 fw-bold"},"訂單管理")],-1),Xe={class:"table table-striped table-hover text-center align-middle"},Ze=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"訂單編號"),e("th",{scope:"col"},"購買人"),e("th",{scope:"col"},"購買產品"),e("th",{scope:"col"},"訂單金額"),e("th",{scope:"col"},"是否付款"),e("th",{scope:"col",width:"150px"},"功能")])],-1),et={class:"text-start"},tt={class:"h6 mb-0 text-truncate fw-bold"},st={class:"d-block text-muted"},ot={class:"text-start"},dt={class:"d-block text-muted"},rt={class:"d-block text-muted"},it={class:"text-start"},at={class:"list-unstyled mb-0"},nt={class:"text-end"},lt=["onClick"],ct=["onClick"],ut={scope:"col",colspan:"6",class:"text-start"};function ht(t,d,s,c,o,i){var _,x,S;const u=p("SweetalertComponent"),h=p("SwitchIsPaid"),b=p("PaginationComponent"),O=p("DelOrderModal"),P=p("OrderModal");return a(),l(f,null,[g(u,{ref:"sweetalert"},null,512),e("div",Qe,[We,e("table",Xe,[Ze,e("tbody",null,[(a(!0),l(f,null,T(t.orders.data,m=>(a(),l("tr",{key:m.id},[e("th",et,[e("h4",tt,r(m.id),1),e("small",st,r(i.handleCreate_at(m.create_at)),1)]),e("td",ot,[n(r(m.user.name)+" ",1),e("small",dt,r(m.user.email),1),e("small",rt,r(m.user.tel),1)]),e("td",it,[e("ul",at,[(a(!0),l(f,null,T(m.products,y=>(a(),l("li",{key:y.id},r(`${y.product.title} *${y.qty}`),1))),128))])]),e("td",nt,"$"+r(m.total),1),e("td",null,[g(h,{order:m,page:t.orders.pagination.current_page},null,8,["order","page"])]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:y=>i.openModal("check",m)},"查看",8,lt),e("button",{type:"button",class:"btn btn-outline-danger btn-sm ms-1",onClick:y=>i.openModal("del",m)},"刪除",8,ct)])]))),128))]),e("tfoot",null,[e("tr",null,[e("th",ut,"訂單數量："+r(i.orderTotal)+" 筆",1)])])]),(_=t.orders.pagination)!=null&&_.total_pages?(a(),j(b,{key:0,pagination:t.orders.pagination,onSwitchPage:t.getOrders},null,8,["pagination","onSwitchPage"])):I("",!0),g(O,{ref:"childDelOrderModal",order:o.currentOrder,page:(x=t.orders.pagination)==null?void 0:x.current_page},null,8,["order","page"]),g(P,{ref:"childOrderModal",order:o.currentOrder,"handle-create_at":i.handleCreate_at,page:(S=t.orders.pagination)==null?void 0:S.current_page},null,8,["order","handle-create_at","page"])])],64)}const yt=k(Je,[["render",ht]]);export{yt as default};
