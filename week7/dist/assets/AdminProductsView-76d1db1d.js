import{b9 as k,aw as h,ak as i,m as n,u as y,n as t,F as f,k as te,a4 as p,aK as o,t as _,l as m,b4 as g,au as S,b8 as oe}from"./plugin-vueexport-helper-6502c603.js";import{L as ie}from"./LoadingStore-344bc819.js";import{P as le}from"./PaginationComponent-a006d26b.js";import{M as se}from"./bootstrap.esm-06211441.js";import{s as ne}from"./Sweetalert2-options-02b29ef3.js";import{g as x,k as ce,l as Y,j as ae}from"./runtime-dom.esm-bundler-8d942a76.js";const re={username:{formType:"input",name:"Email 帳號",type:"email",error:"必填欄位，須符合 Email 格式",validates:{isRequired:!0,pattern:"^([a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,4})*$"}},password:{formType:"input",name:"密碼",type:"password",help:"密碼需至少 8 碼以上，並英數混合",error:"必填欄位，密碼需至少 8 碼以上，並英數混合",validates:{isRequired:!0,pattern:"^(?=.*[0-9])(?=.*[a-zA-Z]).{8,}$"}},product_title:{formType:"input",name:"產品名稱",type:"text",error:"必填欄位，最多 50 個字",validates:{isRequired:!0,maxlength:50}},product_category:{formType:"input",name:"分類",type:"text",error:"必填欄位，最多 15 個字",validates:{isRequired:!0,maxlength:15}},product_AD_type:{formType:"select",name:"廣告標籤",isMultiple:!1,options:[{label:"新品上市",value:"新品上市"},{label:"人氣商品",value:"人氣商品"},{label:"強力主打",value:"強力主打"}],validates:{isRequired:!1}},product_unit:{formType:"input",name:"單位",type:"text",error:"必填欄位",validates:{isRequired:!0}},product_origin_price:{formType:"input",name:"原價",type:"number",error:"必填欄位，需為正整數",validates:{isRequired:!0,min:1}},product_price:{formType:"input",name:"售價",type:"number",error:"必填欄位，需為正整數",validates:{isRequired:!0,min:1}},product_description:{formType:"textarea",name:"產品描述",error:"必填欄位",validates:{isRequired:!0}},product_content:{formType:"textarea",name:"產品內容",error:"必填欄位",validates:{isRequired:!0}},product_imageUrl:{formType:"input",name:"產品主圖網址",type:"text",error:"必填欄位，須符合 url 格式",validates:{isRequired:!0,pattern:"^(https://)[^s]+"}},product_imagesUrl:{formType:"input",name:"其他產品圖片",type:"text",validates:{isRequired:!1}},product_is_enabled:{formType:"radio",name:"是否啟用",options:[{label:"啟用",value:1},{label:"停用",value:0}],validates:{isRequired:!0}},upload_img:{formType:"input",type:"file",accept:"image/*",validates:{data:"須上傳檔案，其檔案格式為 .png、.jpg、.jpg",type:"檔案格式須為 .png、.jpg、.jpg",size:"檔案大小不能超過 1MB"}}};const{VITE_API_URL:de,VITE_API_PATH:ue}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0},pe={data(){return{formsSchema:re,uploadImgUrl:"",errMsgs:[],isLoading:!1}},mounted(){this.uploadImgUrl=this.imageUrl},watch:{imageUrl(){this.uploadImgUrl=this.imageUrl}},methods:{validatesUploadfile(r){this.isLoading=!0,this.errMsgs=[];const{data:s,type:l,size:d}=this.formsSchema.upload_img.validates,e=r.target.files[0];e?(new RegExp("^image/(png|jpg|jpeg)$").test(e.type)||this.errMsgs.push(l),e.size/1024/1024>1&&this.errMsgs.push(d)):this.errMsgs.push(s),this.errMsgs.length?this.setSwalError():this.upload(e)},upload(r){const s=new FormData;s.append("file-to-upload",r),this.$http.post(`${de}/api/${ue}/admin/upload`,s).then(l=>{const{success:d,imageUrl:e}=l.data;d?(this.uploadImgUrl=e,this.emitData()):this.setSwalError()}).catch(l=>{this.setSwalError(l.response.data.message)})},emitData(){const r={dataKey:this.dataKey,uploadImgUrl:this.uploadImgUrl,isInputErr:!!(this.isRequired&&(this.errMsgs.length||!this.uploadImgUrl))};this.isLoading=!1,this.$emit("update-image",r)},setSwalError(r){let s=r;this.errMsgs.length&&(s=this.errMsgs.reduce((d,e)=>d+`<li>${e}</li>`,""),s=`<ul class="list-unstyled">${s}</ul>`);const l={icon:"error",title:"上傳失敗",html:s,timer:null};this.$swal({...ne,...l}),this.uploadImgUrl="",this.emitData()}},props:{imageUrl:{type:String,required:!1},dataKey:{type:String,required:!0},isRequired:{type:Boolean,default:!1}},emits:["update-image"]},me=["type","accept"],_e={class:"bg-light w-100 h-100 d-flex flex-column align-items-center justify-content-center"},he=["src"],ge={key:1,class:"d-flex flex-column align-items-center justify-content-center opacity-50 text-secondary"},fe=t("div",{class:"spinner-border",role:"status","aria-hidden":"true"},null,-1),be=t("small",{class:"pt-1"},"Loading...",-1),ye=[fe,be];function ve(r,s,l,d,e,a){const v=h("sweetalert-component"),b=h("font-awesome-icon");return i(),n(f,null,[y(v,{ref:"sweetalert"},null,512),t("label",{class:p(["file-img rounded p-1",{"border-danger":l.isRequired&&(!e.uploadImgUrl||e.errMsgs.length)}])},[t("input",{class:"form-control d-none",type:e.formsSchema.upload_img.type,accept:e.formsSchema.upload_img.accept,onChange:s[0]||(s[0]=P=>a.validatesUploadfile(P))},null,40,me),t("div",_e,[e.isLoading?(i(),n("div",ge,ye)):(i(),n(f,{key:0},[e.uploadImgUrl?(i(),n("img",{key:0,src:e.uploadImgUrl},null,8,he)):(i(),te(b,{key:1,size:"2x",icon:"fa-solid fa-arrow-up-from-bracket",class:"text-muted opacity-50"}))],64))])],2)],64)}const Pe=k(pe,[["render",ve]]),{VITE_API_URL:$,VITE_API_PATH:ee}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0};let A=null;const Ie={data(){return{formsSchema:re,initCurrentProduct:{},currentProduct:{},isLoading:!1,isInputErr:{},inputHasErr:!1,isInputChangeValue:!1}},mounted(){A=new se(document.getElementById("productModal"),{keyboard:!1}),this.setDefaultCurrentProduct()},computed:{imagesUrlHasDataTotal(){return Object.values(this.currentProduct.imagesUrl).filter(s=>s).length}},watch:{product:{handler(){this.setDefaultCurrentProduct(),this.product.id&&Object.keys(this.product).forEach(s=>{s!=="imagesUrl"?this.currentProduct[s]=this.product[s]:Object.keys(this.currentProduct.imagesUrl).forEach((d,e)=>{const a=this.product.imagesUrl&&this.product.imagesUrl[e]?this.product.imagesUrl[e]:"";this.currentProduct.imagesUrl[d]=a})}),this.initCurrentProduct=JSON.parse(JSON.stringify(this.currentProduct))}},currentProduct:{handler(){const r=Object.keys(this.currentProduct);this.isInputChangeValue=!1,r.forEach(s=>{s==="AD_type"?this.isInputErr.AD_type=!1:s==="imagesUrl"?Object.keys(this.currentProduct.imagesUrl).forEach(d=>{this.isInputErr.imagesUrl||(this.isInputErr.imagesUrl={}),this.isInputErr.imagesUrl[d]=!1}):this.isInputErr[s]=!(this.currentProduct[s]||s==="is_enabled"&&this.currentProduct[s]===0)}),this.getIsInputChangeValue()},deep:!0},isInputErr:{handler(){const r=Object.values(this.isInputErr);this.inputHasErr=r.some(s=>typeof s=="object"?Object.values(s).some(l=>l):s)},deep:!0}},methods:{setDefaultCurrentProduct(){const r={};for(let s=0;s<5;s++)r[`img${s+1}`]="";this.currentProduct={title:"",category:"",AD_type:"",origin_price:null,price:null,unit:"",description:"",content:"",imageUrl:"",imagesUrl:r,is_enabled:1}},openModal(){A.show()},closeModal(r,s){this.isLoading=!1;let l=this.currentProduct.id?"編輯":"新增";A.hide(),this.$emit("get-products",this.currentProduct.id?"":1),setTimeout(()=>{l+=`${r==="success"?"成功":"失敗"}`,this.$refs.sweetalert.showSwal("popup",r,l,s)},500)},getIsInputChangeValue(){const r=Object.keys(this.currentProduct);this.isInputChangeValue=r.some(s=>this.currentProduct[s]&&typeof this.currentProduct[s]=="object"?Object.keys(this.currentProduct[s]).some(l=>this.currentProduct[s][l]!==this.initCurrentProduct[s][l]):this.currentProduct[s]!==this.initCurrentProduct[s])},removeImagesUrlItemData(r){this.currentProduct.imagesUrl[r]="",this.isInputErr.imagesUrl[r]=!1},addOrEditProduct(){this.isLoading=!0,this.currentProduct.imagesUrl=Object.values(this.currentProduct.imagesUrl).filter(s=>s);const r={data:this.currentProduct};this.currentProduct.id?this.$http.put(`${$}/api/${ee}/admin/product/${this.currentProduct.id}`,r).then(s=>{this.closeModal("success",s.data.message)}).catch(s=>{this.closeModal("error",s.response.data.message)}):this.$http.post(`${$}/api/${ee}/admin/product`,r).then(s=>{this.closeModal("success",s.data.message)}).catch(s=>{this.closeModal("error",s.response.data.message)})},handleChildUploadData(r){const{dataKey:s,isInputErr:l,uploadImgUrl:d}=r;s==="imageUrl"?(this.currentProduct.imageUrl=d,this.isInputErr.imageUrl=l):(this.currentProduct.imagesUrl[s]=d,this.isInputErr.imagesUrl[s]=l)}},components:{UploadImg:Pe},props:{product:{type:Object,required:!1}},emits:["get-products"]},Ue=["data-bs-backdrop"],xe={class:"modal-dialog modal-lg"},we={class:"modal-content"},Ee={class:"modal-header bg-light"},Se={class:"modal-title"},ke=["disabled"],Ae={class:"modal-body"},Re=["disabled"],Me={class:"row g-3 pb-3"},Te={class:"col-12"},qe={for:"inputTitle",class:"form-label d-flex align-items-center"},De={key:0,class:"text-danger"},Le=["type","required","maxlength"],Ve={class:"col-md-6"},Ce={for:"inputCategory",class:"form-label d-flex align-items-center"},Oe={key:0,class:"text-danger"},je=["type","required","maxlength"],He={class:"col-md-6"},ze={for:"inputAD_type",class:"form-label d-flex align-items-center"},Be={key:0,class:"text-danger"},Ke=["multiple"],Ne=t("option",{selected:"",value:""},"請選擇",-1),Ge=["value"],Ze={class:"row g-3 pb-3"},Fe={for:"inputImageUrl",class:"form-label"},Je={key:0,class:"text-danger"},Qe={class:"col-auto mt-0"},We={class:"row g-3 pb-3"},Xe={for:"inputImagesUrl",class:"form-label"},Ye={key:0,class:"text-danger"},$e=["onClick"],et={class:"row g-3 pb-3"},tt={class:"col-12"},st={for:"textareaDescription",class:"form-label"},rt={key:0,class:"text-danger"},ot=["required"],it={class:"col-12"},lt={for:"textareaContent",class:"form-label"},nt={key:0,class:"text-danger"},ct=["required"],at={class:"col-md-4"},dt={for:"inputUnit",class:"form-label"},ut={key:0,class:"text-danger"},pt=["type","required"],mt={class:"row g-3 pb-3"},_t={class:"col-md-4"},ht={for:"inputOrigin_price",class:"form-label"},gt={key:0,class:"text-danger"},ft={class:"input-group"},bt=t("span",{class:"input-group-text"},"$",-1),yt=["type","required","min"],vt={class:"col-md-4"},Pt={for:"inputPrice",class:"form-label"},It={key:0,class:"text-danger"},Ut={class:"input-group"},xt=t("span",{class:"input-group-text"},"$",-1),wt=["type","required","min"],Et={class:"row g-3 pb-3"},St={class:"col-12"},kt={class:"form-label d-block"},At={key:0,class:"text-danger"},Rt=["value","id"],Mt=["for"],Tt={class:"modal-footer"},qt=["disabled"],Dt=["disabled"],Lt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Vt(r,s,l,d,e,a){var w,U,u,E,M,T,q,D,L,V,C,O,j,H,z,B,K,N,G,Z,F,J,Q,W;const v=h("sweetalert-component"),b=h("UploadImg"),P=h("upload-img");return i(),n(f,null,[y(v,{ref:"sweetalert"},null,512),t("div",{class:"modal fade",tabindex:"-1",id:"productModal","aria-labelledby":"productModalLabel","data-bs-backdrop":e.isLoading?!0:"static","aria-hidden":"true"},[t("div",xe,[t("div",we,[t("div",Ee,[t("h5",Se,o((w=e.currentProduct)!=null&&w.id?"修改":"新增")+"產品",1),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:e.isLoading},null,8,ke)]),t("div",Ae,[t("form",null,[t("fieldset",{disabled:e.isLoading},[t("div",Me,[t("div",Te,[t("label",qe,[_(o(e.formsSchema.product_title.name)+" ",1),e.formsSchema.product_title.validates.isRequired?(i(),n("span",De," *")):m("",!0),t("small",{class:p(["ms-auto",[((u=(U=e.currentProduct)==null?void 0:U.title)==null?void 0:u.length)===e.formsSchema.product_title.validates.maxlength?"text-danger":"text-muted"]])},o((M=(E=e.currentProduct)==null?void 0:E.title)==null?void 0:M.length)+"/"+o(e.formsSchema.product_title.validates.maxlength),3)]),g(t("input",{type:e.formsSchema.product_title.type,class:p(["form-control",{"is-invalid":(T=e.isInputErr)==null?void 0:T.title}]),id:"inputTitle","aria-describedby":"titleHelp","onUpdate:modelValue":s[0]||(s[0]=c=>e.currentProduct.title=c),required:e.formsSchema.product_title.validates.isRequired,maxlength:e.formsSchema.product_title.validates.maxlength},null,10,Le),[[x,e.currentProduct.title,void 0,{trim:!0,lazy:!0}]]),t("div",{class:p(["invalid-feedback",{"d-block":(q=e.isInputErr)==null?void 0:q.title}])},o(e.formsSchema.product_title.error),3)]),t("div",Ve,[t("label",Ce,[_(o(e.formsSchema.product_category.name),1),e.formsSchema.product_category.validates.isRequired?(i(),n("span",Oe,"* ")):m("",!0),t("small",{class:p(["ms-auto",[((L=(D=e.currentProduct)==null?void 0:D.category)==null?void 0:L.length)===e.formsSchema.product_category.validates.maxlength?"text-danger":"text-muted"]])},o((C=(V=e.currentProduct)==null?void 0:V.category)==null?void 0:C.length)+"/"+o(e.formsSchema.product_category.validates.maxlength),3)]),g(t("input",{type:e.formsSchema.product_category.type,class:p(["form-control",{"is-invalid":(O=e.isInputErr)==null?void 0:O.category}]),id:"inputCategory","aria-describedby":"categoryHelp","onUpdate:modelValue":s[1]||(s[1]=c=>e.currentProduct.category=c),required:e.formsSchema.product_category.validates.isRequired,maxlength:e.formsSchema.product_category.validates.maxlength},null,10,je),[[x,e.currentProduct.category,void 0,{trim:!0,lazy:!0}]]),t("div",{class:p(["invalid-feedback",{"d-block":(j=e.isInputErr)==null?void 0:j.category}])},o(e.formsSchema.product_category.error),3)]),t("div",He,[t("label",ze,[_(o(e.formsSchema.product_AD_type.name),1),e.formsSchema.product_AD_type.validates.isRequired?(i(),n("span",Be,"* ")):m("",!0)]),g(t("select",{id:"inputAD_type",class:"form-select",multiple:e.formsSchema.product_AD_type.isMultiple,"onUpdate:modelValue":s[2]||(s[2]=c=>e.currentProduct.AD_type=c)},[Ne,(i(!0),n(f,null,S(e.formsSchema.product_AD_type.options,c=>(i(),n("option",{value:c.value,key:c.value},o(c.label),9,Ge))),128))],8,Ke),[[ce,e.currentProduct.AD_type]])])]),t("div",Ze,[t("label",Fe,[_(o(e.formsSchema.product_imageUrl.name),1),e.formsSchema.product_imageUrl.validates.isRequired?(i(),n("span",Je,"* ")):m("",!0)]),t("div",Qe,[y(b,{"is-required":!0,"data-key":"imageUrl","image-url":e.currentProduct.imageUrl,onUpdateImage:a.handleChildUploadData},null,8,["image-url","onUpdateImage"])])]),t("div",We,[t("label",Xe,[_(o(e.formsSchema.product_imagesUrl.name),1),e.formsSchema.product_imagesUrl.validates.isRequired?(i(),n("span",Ye,"* ")):m("",!0)]),(i(!0),n(f,null,S(e.currentProduct.imagesUrl,(c,I)=>(i(),n("div",{class:"col-auto mt-0 d-flex flex-column",key:I},[y(P,{"data-key":I,"image-url":c,onUpdateImage:a.handleChildUploadData},null,8,["data-key","image-url","onUpdateImage"]),c&&a.imagesUrlHasDataTotal!==0?(i(),n("button",{key:0,type:"button",class:"btn btn-link btn-sm text-danger text-decoration-none",onClick:X=>a.removeImagesUrlItemData(I)}," 刪除 ",8,$e)):m("",!0)]))),128))]),t("div",et,[t("div",tt,[t("label",st,[_(o(e.formsSchema.product_description.name),1),e.formsSchema.product_description.validates.isRequired?(i(),n("span",rt,"*")):m("",!0)]),g(t("textarea",{rows:"10",class:p(["form-control",{"is-invalid":(H=e.isInputErr)==null?void 0:H.description}]),id:"textareaDescription","onUpdate:modelValue":s[3]||(s[3]=c=>e.currentProduct.description=c),required:e.formsSchema.product_description.validates.isRequired},null,10,ot),[[Y,e.currentProduct.description,void 0,{trim:!0,lazy:!0}]]),t("div",{class:p(["invalid-feedback",{"d-block":(z=e.isInputErr)==null?void 0:z.description}])},o(e.formsSchema.product_description.error),3)]),t("div",it,[t("label",lt,[_(o(e.formsSchema.product_content.name),1),e.formsSchema.product_content.validates.isRequired?(i(),n("span",nt,"*")):m("",!0)]),g(t("textarea",{rows:"3",class:p(["form-control",{"is-invalid":(B=e.isInputErr)==null?void 0:B.content}]),id:"textareaContent","onUpdate:modelValue":s[4]||(s[4]=c=>e.currentProduct.content=c),required:e.formsSchema.product_content.validates.isRequired},null,10,ct),[[Y,e.currentProduct.content,void 0,{trim:!0,lazy:!0}]]),t("div",{class:p(["invalid-feedback",{"d-block":(K=e.isInputErr)==null?void 0:K.content}])},o(e.formsSchema.product_content.error),3)]),t("div",at,[t("label",dt,[_(o(e.formsSchema.product_unit.name),1),e.formsSchema.product_unit.validates.isRequired?(i(),n("span",ut,"* ")):m("",!0)]),g(t("input",{type:e.formsSchema.product_unit.type,class:p(["form-control",{"is-invalid":(N=e.isInputErr)==null?void 0:N.unit}]),id:"inputUnit","aria-describedby":"unitHelp","onUpdate:modelValue":s[5]||(s[5]=c=>e.currentProduct.unit=c),required:e.formsSchema.product_unit.validates.isRequired},null,10,pt),[[x,e.currentProduct.unit,void 0,{trim:!0,lazy:!0}]]),t("div",{class:p(["invalid-feedback",{"d-block":(G=e.isInputErr)==null?void 0:G.unit}])},o(e.formsSchema.product_unit.error),3)])]),t("div",mt,[t("div",_t,[t("label",ht,[_(o(e.formsSchema.product_origin_price.name),1),e.formsSchema.product_origin_price.validates.isRequired?(i(),n("span",gt,"* ")):m("",!0)]),t("div",ft,[bt,g(t("input",{type:e.formsSchema.product_origin_price.type,class:p(["form-control",{"is-invalid":(Z=e.isInputErr)==null?void 0:Z.origin_price}]),id:"inputOrigin_price","aria-describedby":"origin_priceHelp","onUpdate:modelValue":s[6]||(s[6]=c=>e.currentProduct.origin_price=c),required:e.formsSchema.product_origin_price.validates.isRequired,min:e.formsSchema.product_origin_price.validates.min},null,10,yt),[[x,e.currentProduct.origin_price,void 0,{trim:!0,number:!0,lazy:!0}]])]),t("div",{class:p(["invalid-feedback",{"d-block":(F=e.isInputErr)==null?void 0:F.origin_price}])},o(e.formsSchema.product_origin_price.error),3)]),t("div",vt,[t("label",Pt,[_(o(e.formsSchema.product_price.name),1),e.formsSchema.product_price.validates.isRequired?(i(),n("span",It,"* ")):m("",!0)]),t("div",Ut,[xt,g(t("input",{type:e.formsSchema.product_price.type,class:p(["form-control",{"is-invalid":(J=e.isInputErr)==null?void 0:J.price}]),id:"inputPrice","aria-describedby":"priceHelp","onUpdate:modelValue":s[7]||(s[7]=c=>e.currentProduct.price=c),required:e.formsSchema.product_price.validates.isRequired,min:e.formsSchema.product_price.validates.min},null,10,wt),[[x,e.currentProduct.price,void 0,{trim:!0,number:!0,lazy:!0}]])]),t("div",{class:p(["invalid-feedback",{"d-block":(Q=e.isInputErr)==null?void 0:Q.price}])},o(e.formsSchema.product_price.error),3)])]),t("div",Et,[t("div",St,[t("label",kt,[_(o(e.formsSchema.product_is_enabled.name),1),e.formsSchema.product_is_enabled.validates.isRequired?(i(),n("span",At,"*")):m("",!0)]),(i(!0),n(f,null,S(e.formsSchema.product_is_enabled.options,(c,I)=>(i(),n("div",{class:"form-check form-check-inline",key:c.value},[g(t("input",{class:"form-check-input",value:c.value,type:"radio",name:"is_enabledRadio",id:"is_enabledRadio-"+I,"onUpdate:modelValue":s[8]||(s[8]=X=>e.currentProduct.is_enabled=X)},null,8,Rt),[[ae,e.currentProduct.is_enabled]]),t("label",{class:"form-check-label",for:"is_enabledRadio-"+I},o(c.label),9,Mt)]))),128))])])],8,Re)])]),t("div",Tt,[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",disabled:e.isLoading},"取消",8,qt),t("button",{type:"submit",class:"btn btn-primary",disabled:e.isLoading||!e.isInputChangeValue||e.inputHasErr,onClick:s[9]||(s[9]=(...c)=>a.addOrEditProduct&&a.addOrEditProduct(...c))},[e.isLoading?(i(),n("span",Lt)):m("",!0),_(" "+o((W=e.currentProduct)!=null&&W.id?"修改":"新增"),1)],8,Dt)])])])],8,Ue)],64)}const Ct=k(Ie,[["render",Vt]]),{VITE_API_URL:Ot,VITE_API_PATH:jt}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0};let R=null;const Ht={data(){return{isLoading:!1}},mounted(){R=new se(document.getElementById("delProductModal"),{keyboard:!1})},methods:{openModal(){R.show()},closeModal(r,s){this.isLoading=!1,R.hide(),r==="success"&&this.$emit("get-products"),setTimeout(()=>{const l=`刪除${r==="success"?"成功":"失敗"}`;this.$refs.sweetalert.showSwal("popup","error",l,s)},500)},delProduct(){this.isLoading=!0,this.$http.delete(`${Ot}/api/${jt}/admin/product/${this.product.id}`).then(r=>{this.closeModal("success",r.data.message)}).catch(r=>{this.closeModal("error",r.response.data.message)})}},props:{product:{type:Object,required:!0}},emits:["get-products"]},zt=["data-bs-backdrop"],Bt={class:"modal-dialog"},Kt={class:"modal-content"},Nt={class:"modal-header bg-danger text-white"},Gt=t("h5",{class:"modal-title"},"刪除產品",-1),Zt=["disabled"],Ft={class:"modal-body"},Jt={class:"modal-footer"},Qt=["disabled"],Wt=["disabled"],Xt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Yt(r,s,l,d,e,a){var b;const v=h("sweetalert-component");return i(),n(f,null,[y(v,{ref:"sweetalert"},null,512),t("div",{class:"modal fade",tabindex:"-1",id:"delProductModal","aria-labelledby":"delProductModalLabel","data-bs-backdrop":e.isLoading?!0:"static","aria-hidden":"true"},[t("div",Bt,[t("div",Kt,[t("div",Nt,[Gt,t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",disabled:e.isLoading},null,8,Zt)]),t("div",Ft,[t("p",null,[_(" 請確認是否"),t("strong",null,"刪除「"+o((b=l.product)==null?void 0:b.title)+"」產品",1),_("，刪除後您再也無法復原？ ")])]),t("div",Jt,[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",disabled:e.isLoading},"否",8,Qt),t("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=(...P)=>a.delProduct&&a.delProduct(...P)),disabled:e.isLoading},[e.isLoading?(i(),n("span",Xt)):m("",!0),_(" 是，確認刪除 ")],8,Wt)])])])],8,zt)],64)}const $t=k(Ht,[["render",Yt]]);const{VITE_API_URL:es,VITE_API_PATH:ts}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"ella-diving",BASE_URL:"/vue3-live-weekly-homework/week7/dist/",MODE:"production",DEV:!1,PROD:!0},ss={data(){return{products:{},currentProduct:{}}},computed:{productTotal(){return this.products.data?Object.keys(this.products.data).length:0}},mounted(){this.getProducts()},components:{PaginationComponent:le,ProductModal:Ct,DelProductModal:$t},methods:{...oe(ie,["showLoading","hideLoading"]),getProducts(r){this.showLoading(),r||(r=this.products.pagination?this.products.pagination.current_page:1),this.$http.get(`${es}/api/${ts}/admin/products?page=${r}`).then(s=>{const{products:l,pagination:d}=s.data;this.products={data:l,pagination:d},this.hideLoading()}).catch(s=>{this.hideLoading(),this.$refs.sweetalert.showSwal("popup","error",s.response.data.message)})},openModal(r,s){this.currentProduct={...s},r==="del"?this.$refs.childDelProductModal.openModal():this.$refs.childProductModal.openModal()}}},rs={class:"container"},os={class:"d-flex justify-content-between align-items-center mb-3"},is=t("h1",{class:"mb-0 h4 fw-bold"},"產品管理",-1),ls={class:"table table-striped table-hover text-center align-middle"},ns=t("thead",null,[t("tr",null,[t("th",{scope:"col",width:"200px"},"產品名稱"),t("th",{scope:"col",width:"120px"},"分類"),t("th",{scope:"col",width:"120px"},"廣告標籤"),t("th",{scope:"col",width:"120px"},"原價"),t("th",{scope:"col",width:"120px"},"售價"),t("th",{scope:"col",width:"120px"},"是否啟用"),t("th",{scope:"col",width:"150px"},"功能")])],-1),cs={class:"d-flex align-items-center"},as=["src","alt"],ds={class:"h6 mb-0 text-truncate fw-bold"},us={scope:"row",class:"text-truncate"},ps={class:"text-truncate"},ms={class:"text-end"},_s={class:"text-end"},hs=["onClick"],gs=["onClick"],fs={scope:"col",colspan:"7",class:"text-start"};function bs(r,s,l,d,e,a){var U;const v=h("SweetalertComponent"),b=h("PaginationComponent"),P=h("DelProductModal"),w=h("ProductModal");return i(),n(f,null,[y(v,{ref:"sweetalert"},null,512),t("div",rs,[t("div",os,[is,t("button",{type:"button",class:"btn btn-primary",onClick:s[0]||(s[0]=u=>a.openModal("add"))},"新增產品")]),t("table",ls,[ns,t("tbody",null,[(i(!0),n(f,null,S(e.products.data,u=>(i(),n("tr",{key:u.id},[t("th",null,[t("div",cs,[t("img",{src:u.imageUrl,alt:`${u.category} - ${u.title}`,class:"img-box flex-shrink-0 rounded border me-2"},null,8,as),t("h4",ds,o(u.title),1)])]),t("td",us,o(u.category),1),t("td",ps,o(u.AD_type?u.AD_type:"未分類"),1),t("td",ms,"$"+o(u.origin_price),1),t("td",_s,"$"+o(u.price),1),t("td",null,[t("strong",{class:p([u.is_enabled?"text-success":"text-danger"])},o(u.is_enabled?"啟用":"停用"),3)]),t("td",null,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:E=>a.openModal("edit",u)},"編輯",8,hs),t("button",{type:"button",class:"btn btn-outline-danger btn-sm ms-1",onClick:E=>a.openModal("del",u)},"刪除",8,gs)])]))),128))]),t("tfoot",null,[t("tr",null,[t("th",fs,"產品數量："+o(a.productTotal)+" 筆",1)])])]),(U=e.products.pagination)!=null&&U.total_pages?(i(),te(b,{key:0,pagination:e.products.pagination,onSwitchPage:a.getProducts},null,8,["pagination","onSwitchPage"])):m("",!0)]),y(P,{ref:"childDelProductModal",product:e.currentProduct,onGetProducts:a.getProducts},null,8,["product","onGetProducts"]),y(w,{ref:"childProductModal",product:e.currentProduct,onGetProducts:a.getProducts},null,8,["product","onGetProducts"])],64)}const ws=k(ss,[["render",bs]]);export{ws as default};
